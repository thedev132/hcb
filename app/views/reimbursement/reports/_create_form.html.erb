<section data-behavior="modal" role="dialog" id="create" class="modal modal--scroll bg-snow">
  <%= form_with(model: Reimbursement::Report, class: "mb3", style: "max-width: 600px;", method: :post) do |form| %>
    <%= modal_header "Open a Report" %>
    <%= form.label :report_name, "Report Name", class: "bold" %>
    <%= form.text_field :report_name, placeholder: "Chicago Trip Expenses", required: true %>
    <% if defined? @event %>
      <fieldset data-behavior="reimbursement_report_create_form_type_selection" class="mt2">
        <legend class="bold pb2">Who is this reimbursement for?</legend>
        <div class="field field--options trio">
          <%= form.radio_button :for, "myself", checked: true %>
          <%= form.label :for, value: "myself" do %>
            <%= inline_icon "like", size: 28 %>
            <strong>Myself</strong>
          <% end %>
          <%= form.radio_button :for, "organizer" %>
          <%= form.label :for, value: "organizer" do %>
            <%= inline_icon "friend", size: 28 %>
            <strong>Another Organizer</strong>
          <% end %>
          <%= form.radio_button :for, "external" %>
          <%= form.label :for, value: "external" do %>
            <%= inline_icon "person", size: 28 %>
            <strong>External Contributor</strong>
          <% end %>
        </div>
      </fieldset>
      <%= form.select(:user_email, @event.users.reject { |u| u.email == @current_user.email }.map { |u| [u.name, u.email] }) %>
      <%= form.text_field :email, class: "display-none-not-important mt1", placeholder: "Enter this individual's email", data: { "behavior": "reimbursement_report_email_input" }, required: true, value: @current_user.email %>
      <%= form.hidden_field :event_id, value: @event.id %>
      <div id="reimbursement_report_maximum_amount_wrapper">
        <%= form.label :maximum_amount, "Maximum Reimbursable Value (Optional)", class: "mt2 bold" %>
        <div class="field">
          <div class="flex items-center">
            <span class="bold muted" style="width: 1rem;">$</span>
            <%= form.number_field :maximum_amount, placeholder: "500.00", step: 0.01, min: 0.01, required: false, data: { controller: "truncate-decimal", action: "truncate-decimal#truncate" } %>
          </div>
        </div>
      </div>
      <div id="reimbursement_report_invite_message_wrapper">
        <%= form.label :invite_message, "Invite Message", class: "mt1 bold" %>
        <%= form.text_area :invite_message, placeholder: "We're excited to see your expenses..." %>
      </div>
    <% else %>
      <%= form.hidden_field :user_id, value: current_user.id %>
      <%= form.hidden_field :email, value: current_user.email %>

      <%= form.label :event_id, "Organization", class: "mt1 bold" %>
      <%= form.select :event_id, current_user.events.not_demo_mode.pluck(:name, :id) %>
    <% end %>
    <div class="tooltipped tooltipped--e inline-block" aria-label="<%= @event&.demo_mode? ? "You don't have access to this feature at the moment." : "This will start your reimbursement report." %>">
      <%= form.submit "Start report", class: "mt2", disabled: (!organizer_signed_in? || @event&.demo_mode?) %>
    </div>
  <% end %>
</section>
